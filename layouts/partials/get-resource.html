{{/*
  IN:
    - name: Name of the resource
    - currentPage: The page calling the resource
  OUT: Resource or empty string
*/}}
{{ $name := .name }}
{{ $resource := "" }}
{{ with .currentPage }}
    {{ with .Resources.GetMatch $name }}
        {{ $resource = . }}
    {{ else }}
        {{ range $i, $tag := .GetTerms "tags" }}
            {{ warnf "tag %d: %v" $i $tag }}
            {{ with $tag.Page.Resources.GetMatch $name }}
                {{ if eq $resource "" }}
                    {{ $resource = . }}
                {{ end }}
            {{ end }}
        {{ end }}
        {{ if eq $resource "" }}
            {{ $resource = (partial "resource-in-parent.html" ( dict "name" $name "currentPage" . ))}}
        {{ end }}
    {{ end }}
{{ end }}
{{ if not $resource }}
    {{ warnf "There is no resource with the name '%s' for the %v or its parent sections." $name .currentPage }}
{{ end }}
{{ return $resource }}

{{ define "partials/resource-in-parent.html" }}
    {{ $name := .name }}
    {{ $resource := "" }}
    {{ with .currentPage.Parent }}
        {{ with .Resources.GetMatch $name }}
            {{ $resource = . }}
        {{ else }}
            {{ $resource = partial "resource-in-parent.html" ( dict "name" $name "currentPage" . )}}
        {{ end }}
    {{ end }}
    {{ return $resource }}
{{ end }}
